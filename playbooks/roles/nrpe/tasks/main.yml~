---

- name: installs nrpe packages
  apt: name={{item}} state=present update_cache=true
  with_items: "{{ nrpe_packages }}"

- name: create nrpe.cfg from template
  template: >
    src=nrpe.cfg.j2
    dest={{ nrpe_dir }}/nrpe.cfg
    owner=root group=root mode=0644
  notify: restart nrpe service

- name: ensures plugins directory exists
  file:
      path: "{{ nrpe_dir }}/plugins"
      state: directory

- name: copy nrpe plugins
  copy:
      src: "{{ item }}"
      dest: "{{ nrpe_dir }}/plugins"
      mode: 0755
  with_fileglob:
      - plugins/*

- name: ensures commands directory exists
  file:
      path: "{{ nrpe_dir }}/commands"
      state: directory

- name: copy nrpe commands
  copy:
      src: "{{ item }}"
      dest: "{{ nrpe_dir }}/commands"
      mode: 0644
  with_fileglob:
      - commands/*

- name: ensures nrpe.d directory exists
  file:
      path: "{{ nrpe_dir }}/nrpe.d"
      state: directory

- name: copy nrpe.d configuration
  copy:
      src: "{{ item }}"
      dest: "{{ nrpe_dir }}/nrpe.d"
      mode: 0644
  with_fileglob:
      - nrpe.d/*

