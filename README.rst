OpsMgr
=============

This project installs Nagios, ElasticSearch, Logstash and Kibana (ELK stack), and the opsmgr
command line and user interface (as an OpenStack Horizon extension) on the cluster controller
nodes that have been deployed with os-services. Nagios is automatically configured to monitor the
Openstack services running in the cluster. Kibana dashboards are provided to monitor the logs
generated by Openstack and Ceph. In addition OpsMgr is fully extensible via plugins to support
additional open Ops tools (besides Nagios and ELK) and additional types of resources
(besides OpenStack services) in the future.

In a typical Private Cloud scenario each node in the cluster is pre-conditioned by the
cluster-genesis project which provides bare metal operating system installation services
and then it invokes a solution specific service which in this case is provided by the os-services
project. This latter project guides the installation and configuration of Openstack and then
orchestrates the installation of the OpsMgr stack of services for operational management.

The os-services orchestration of OpsMgr is achieved by setting the following variables::

   > export DEPLOY_OPSMGR=yes
   > export ANSIBLE_HOST_KEY_CHECKING=False
     
And then running the following scripts::

   > ./scripts/bootstrap-opsmgr.sh
   > ./scripts/create-cluster-opsmgr.sh 

Those scripts will perform the following sequence of steps:

  * execution of recipes/privatelcoud-mitaka Ansible playbook that queries OpenStack-Ansible
    for variables necessary for the install of opsmgr in an Openstack-Ansible controller

  * execution of playbooks/setup.yml Ansible playbook that provisions ssh keys
    to each endpoint managed by opsmgr

  * execution of playbooks/hosts.yml Ansible playbook that creates containers for Nagios and
    the ELK stack
  
  * execution of playbooks/site.yml Ansible playbook to deploy the opsmgr service and dashboards
    (within OpenStack Horizon containers) and completely installs Nagios server and the ELK
    stack and configures haproxy and database
  
  * execution of playbooks/target.yml Ansible playbook to deploy the endpoint services for Nagios (NRPE)
    and ELK (Beaver) and to push all necessary configuration at the endpoints that will be managed
    by the OpsMgr stack

Extensibility for OpsMgr can be easily achieved by providing additional Ansible playbooks. 

The scripts above may be invoked manually to resolve errors, particularly network timeout
related errors.

The default credentials for the integrated Ops applications are::

    Nagios user: nagios
    Nagios password: nagios
    Kibana user: kibana
    Kibana password: kibana

It is recommended that the user changes these passwords after initial install, using these tool's
documented practices.

If a different default value is desired, please set or modify the following Ansible variables prior to installing OpsMgr:

For Nagios::

    nagios_group: nagios (all configuration for Nagios can be changed by users belonging to this group)
    nagios_user:  nagios
    nagios_pass:  nagios
    Location: playbooks/roles/nagios/defaults/main.yml (or use standard Ansible override mechanisms: vars, group_vars, extra_vars, etc.)

For ELK::

    kibana_service_user: kibana
    kibana_password: kibana
    Location: playbooks/roles/kibana/defaults/main.yml (or use standard Ansible override mechanisms: vars, group_vars, extra_vars, etc.)

For the opsmgr galera database::

    db_user: opsmgr
    db_password: passw0rd
    Location: recipes/<recipe name>/templates/vars.yml.j2 (The recipe name for a cloud deployed with cluster-genesis and os-services is
    privatecloud-mitaka) 

Additional OpsMgr deployment default parameters can be overridden as well. For options please check
this file: playbooks/defaults/main.yml

Related projects
----------------
::

    > cluster-genesis
    > os-services
    > ceph-services
